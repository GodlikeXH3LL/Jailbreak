
local library = loadstring(game:HttpGet("https://raw.githubusercontent.com/memejames/elerium-v2-ui-library/main/Library", true))()

local window = library:AddWindow("99 Nights in the Forest", {
    main_color = Color3.fromRGB(0, 0, 0),
    min_size = Vector2.new(470, 470),
    can_resize = true,
})

local Main = window:AddTab("Player")
local folder1 = Main:AddFolder("Other Players")

folder1:AddSwitch("ESP", function(state)
    local espEnabled = state -- Changed from global 'esp' to local 'espEnabled'

    if espEnabled then
        local nameFont = Enum.Font.Garamond
        local distanceFont = Enum.Font.Bangers
        local nameColor = Color3.fromRGB(255, 255, 255)
        local distanceColor = Color3.fromRGB(255, 0, 0)
        local textSize = 14

        local Players = game:GetService("Players")
        local RunService = game:GetService("RunService")
        local LocalPlayer = Players.LocalPlayer
        local espGuis = {}

        local function createESP(player)
            if player == LocalPlayer or not player.Character or not player.Character:FindFirstChild("Head") then
                return
            end

            if espGuis[player] then
                espGuis[player]:Destroy()
                espGuis[player] = nil
            end

            local billboard = Instance.new("BillboardGui")
            billboard.Name = "ESP"
            billboard.Adornee = player.Character.Head
            billboard.AlwaysOnTop = true
            billboard.Size = UDim2.new(0, 200, 0, 50)
            billboard.StudsOffset = Vector3.new(0, 3, 0)
            billboard.Parent = player.Character.Head

            local nameLabel = Instance.new("TextLabel")
            nameLabel.Name = "Name"
            nameLabel.Text = player.Name
            nameLabel.Font = nameFont
            nameLabel.TextColor3 = nameColor
            nameLabel.TextSize = textSize
            nameLabel.BackgroundTransparency = 1
            nameLabel.Size = UDim2.new(1, 0, 0.5, 0)
            nameLabel.Position = UDim2.new(0, 0, 0, 0)
            nameLabel.Parent = billboard

            local distanceLabel = Instance.new("TextLabel")
            distanceLabel.Name = "Distance"
            distanceLabel.Text = "Distance: Calculating..."
            distanceLabel.Font = distanceFont
            distanceLabel.TextColor3 = distanceColor
            distanceLabel.TextSize = textSize
            distanceLabel.BackgroundTransparency = 1
            distanceLabel.Size = UDim2.new(1, 0, 0.5, 0)
            distanceLabel.Position = UDim2.new(0, 0, 0.5, 0)
            distanceLabel.Parent = billboard

            espGuis[player] = billboard
        end

        local function updateESP()
            if not espEnabled then return end

            local localChar = LocalPlayer.Character
            if not localChar or not localChar:FindFirstChild("HumanoidRootPart") then return end

            local localPos = localChar.HumanoidRootPart.Position

            for player, gui in pairs(espGuis) do
                if player and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                    local targetPos = player.Character.HumanoidRootPart.Position
                    local distance = (localPos - targetPos).Magnitude
                    gui.Distance.Text = string.format("Distance: %.1f studs", distance)
                else
                    gui:Destroy()
                    espGuis[player] = nil
                end
            end
        end

        Players.PlayerAdded:Connect(function(player)
            player.CharacterAdded:Connect(function()
                if espEnabled then
                    createESP(player)
                end
            end)
        end)

        Players.PlayerRemoving:Connect(function(player)
            if espGuis[player] then
                espGuis[player]:Destroy()
                espGuis[player] = nil
            end
        end)

        for _, player in ipairs(Players:GetPlayers()) do
            if player ~= LocalPlayer and player.Character then
                createESP(player)
            end
            player.CharacterAdded:Connect(function()
                if espEnabled then
                    createESP(player)
                end
            end)
        end

        RunService.RenderStepped:Connect(updateESP)
    else
        -- Clean up when ESP is disabled
        for player, gui in pairs(espGuis or {}) do
            if gui then
                gui:Destroy()
            end
        end
        espGuis = {}
    end
end)
